<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>商品目录</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 20px; background: #f8f9fa; }
    h1 { text-align: center; color: #333; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
    .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: transform 0.2s; }
    .card:hover { transform: translateY(-5px); }
    .card img { width: 100%; height: 200px; object-fit: cover; }
    .info { padding: 16px; }
    .name { font-size: 1.3em; font-weight: bold; margin: 0 0 8px; color: #222; }
    .price { font-size: 1.5em; color: #e91e63; font-weight: bold; }
    .unit, .category { color: #666; margin-top: 4px; }
  </style>
</head>
<body>
  <h1>商品目录</h1>
  <div id="products" class="grid"></div>

  <script>
    async function loadProducts() {
      const response = await fetch('https://api.github.com/repos/7723qqes/product-catalog/contents/products');
      const files = await response.json();

      const products = [];
      for (const file of files) {
        if (file.name.endsWith('.yml') || file.name.endsWith('.yaml')) {
          const contentResp = await fetch(file.download_url);
          const text = await contentResp.text();
          const data = jsyaml.load(text);  // 需要加载 js-yaml
          if (data.visible !== false) {  // 默认显示，visible: false 才隐藏
            products.push({ ...data, filename: file.name });
          }
        }
      }

      // 排序（可选，按名称）
      products.sort((a, b) => a.name.localeCompare(b.name));

      const container = document.getElementById('products');
      container.innerHTML = products.map(p => `
        <div class="card">
          ${p.image ? `<img src="${p.image}" alt="${p.name}">` : '<div style="height:200px;background:#eee;display:flex;align-items:center;justify-content:center;color:#999;">无图片</div>'}
          <div class="info">
            <div class="name">${p.name || '无名称'}</div>
            <div class="price">${p.price || 0} ${p.currency || 'USD'}</div>
            <div class="unit">${p.unit || ''}</div>
            <div class="category">${p.category || ''}</div>
          </div>
        </div>
      `).join('');
    }

    // 加载 js-yaml CDN
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js';
    script.onload = loadProducts;
    document.head.appendChild(script);
  </script>
</body>
</html>
